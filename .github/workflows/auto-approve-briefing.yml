name: Auto Approve Briefing PR

on:
  pull_request:
    types: [opened, labeled]

permissions:
  pull-requests: write
  contents: write

jobs:
  auto-approve:
    runs-on: ubuntu-latest
    # 3ì¤‘ ë³´ì•ˆ ê²€ì¦:
    # 1. auto-briefing ë¼ë²¨ì´ ìˆì–´ì•¼ í•¨
    # 2. GitHub Actions Botì´ ë§Œë“  PRì´ì–´ì•¼ í•¨
    # 3. briefing/ ë¸Œëœì¹˜ì—ì„œ ì‹œì‘ëœ PRì´ì–´ì•¼ í•¨
    if: |
      contains(github.event.pull_request.labels.*.name, 'auto-briefing') &&
      github.event.pull_request.user.login == 'github-actions[bot]' &&
      startsWith(github.event.pull_request.head.ref, 'briefing/')

    steps:
      - name: Verify PR is safe to approve
        run: |
          echo "ğŸ” Verifying PR safety..."
          echo "PR #${{ github.event.pull_request.number }}"
          echo "Created by: ${{ github.event.pull_request.user.login }}"
          echo "Branch: ${{ github.event.pull_request.head.ref }}"
          echo "Title: ${{ github.event.pull_request.title }}"

          # ë¸Œëœì¹˜ ì´ë¦„ì´ ë‚ ì§œ íŒ¨í„´ì¸ì§€ í™•ì¸ (briefing/YYYY-MM-DD)
          BRANCH="${{ github.event.pull_request.head.ref }}"
          if [[ ! "$BRANCH" =~ ^briefing/[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]; then
            echo "âŒ Invalid branch name pattern. Expected: briefing/YYYY-MM-DD"
            exit 1
          fi

          echo "âœ… All security checks passed"

      - name: Auto approve
        uses: hmarr/auto-approve-action@v4
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}

      - name: Log approval
        run: |
          echo "âœ… Automatically approved PR #${{ github.event.pull_request.number }}"
          echo "ğŸ“… Branch: ${{ github.event.pull_request.head.ref }}"
          echo "ğŸ¤– Created by: ${{ github.event.pull_request.user.login }}"
